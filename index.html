<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BALOO BITE</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #111; border: 2px solid #ff8c00; border-radius: 20px; padding: 40px; text-align: center; width: 320px; }
        #log { background: #000; padding: 10px; font-family: monospace; font-size: 10px; color: #00ffcc; border: 1px solid #333; margin-bottom: 20px; text-align: left; min-height: 40px; }
        .pot { font-size: 40px; font-weight: bold; color: #ffcc00; margin-bottom: 20px; }
        .btn { background: #ff8c00; border: none; padding: 20px; width: 100%; border-radius: 12px; color: #fff; font-size: 20px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
    </style>
</head>
<body>

<div class="card">
    <div id="log">SYSTEM_READY</div>
    <div class="pot" id="pot-display">0.00</div>
    <div style="font-size: 12px; color: #888; margin-bottom: 20px;">JACKPOT BALANCE (XNT)</div>
    <button class="btn" onclick="executeBite()">CHOMP!</button>
</div>

<script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
<script>
    const TARGET = "BAavP6nxHDkVDowYXoyDaNDbc9CAgncfDPELAyjzoyTq";
    const RPC = "https://testnet-rpc.x1.xyz";

    // 1. STABLE CONNECTION HANDLER
    async function getConnection() {
        return new solanaWeb3.Connection(RPC, {
            commitment: 'confirmed',
            disableRetryOnRateLimit: false
        });
    }

    // 2. REFRESH BALANCE
    async function refreshBalance() {
        try {
            const conn = await getConnection();
            const balance = await conn.getBalance(new solanaWeb3.PublicKey(TARGET));
            document.getElementById('pot-display').innerText = (balance / 1e9).toFixed(2);
        } catch (e) {
            document.getElementById('log').innerText = "ERROR: CONNECTION_TIMEOUT";
        }
    }

    // 3. CORE TRANSACTION LOGIC
    async function executeBite() {
        const provider = window.x1 || window.solana;
        const log = document.getElementById('log');

        if (!provider) {
            log.innerText = "ERROR: INSTALL_X1_WALLET";
            return;
        }

        try {
            log.innerText = "STATUS: CONNECTING...";
            const session = await provider.connect();
            const userKey = session.publicKey;

            log.innerText = "STATUS: SYNCING_BLOCKHASH...";
            const conn = await getConnection();
            const { blockhash } = await conn.getLatestBlockhash('finalized');

            const transaction = new solanaWeb3.Transaction();
            transaction.recentBlockhash = blockhash;
            transaction.feePayer = userKey;

            transaction.add(
                solanaWeb3.SystemProgram.transfer({
                    fromPubkey: userKey,
                    toPubkey: new solanaWeb3.PublicKey(TARGET),
                    lamports: 1.0 * 1e9 // 1.0 XNT
                })
            );

            log.innerText = "STATUS: AWAITING_SIGNATURE...";
            const signed = await provider.signAndSendTransaction(transaction);
            
            log.innerText = "SUCCESS: " + signed.substring(0, 10);
            refreshBalance();
        } catch (err) {
            log.innerText = "FAILED: " + err.message.toUpperCase().substring(0, 30);
            console.error(err);
        }
    }

    window.addEventListener('load', refreshBalance);
    setInterval(refreshBalance, 15000);
</script>

</body>
</html>
