<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BALOO BITE - TEST MODE</title>
    <style>
        :root { --gold: #ffcc00; --orange: #ff8c00; --dark: #0a0a0a; --burn: #ff4500; }
        body { background: var(--dark); color: white; font-family: 'Segoe UI', Tahoma, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .game-card { background: #111; border: 2px solid var(--orange); border-radius: 30px; padding: 40px; width: 400px; text-align: center; box-shadow: 0 0 50px rgba(255,140,0,0.2); }
        
        .jackpot-container { background: rgba(255,204,0,0.1); border: 1px solid var(--gold); border-radius: 15px; padding: 20px; margin-bottom: 15px; }
        .jackpot-amount { font-size: 48px; font-weight: 900; color: var(--gold); text-shadow: 0 0 15px var(--gold); }
        
        .status-bar { font-family: monospace; font-size: 11px; color: #00ffcc; margin-bottom: 15px; min-height: 15px; }
        .amount-selector { font-size: 20px; font-weight: bold; margin: 15px 0; color: var(--orange); }
        input[type=range] { width: 100%; accent-color: var(--orange); cursor: pointer; }
        
        .btn-chomp { background: linear-gradient(180deg, var(--orange), #cc7000); border: none; padding: 20px; width: 100%; border-radius: 15px; color: white; font-size: 24px; font-weight: bold; cursor: pointer; text-transform: uppercase; transition: 0.2s; box-shadow: 0 8px 0 #884a00; }
        .btn-chomp:active { transform: translateY(4px); box-shadow: 0 4px 0 #884a00; }
        
        .test-label { background: #ff4500; color: white; font-size: 10px; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; margin-bottom: 10px; display: inline-block; }
    </style>
</head>
<body>

<div class="game-card">
    <div class="test-label">Test Mode: All flows to Main Wallet</div>
    <div class="status-bar" id="status">CONNECTING TO X1...</div>
    
    <div class="jackpot-container">
        <div style="font-size: 12px; text-transform: uppercase; color: var(--gold);">Live Pot Balance</div>
        <div class="jackpot-amount" id="pot-display">0.00</div>
        <div style="font-size: 12px; color: var(--gold);">XNT</div>
    </div>

    <div class="amount-selector">
        BITE SIZE: <span id="bite-val">1.0</span> XNT
        <input type="range" id="bite-slider" min="0.1" max="10" step="0.1" value="1.0">
    </div>

    <button class="btn-chomp" onclick="playGame()">CHOMP!</button>
    
    <p style="font-size: 10px; color: #555; margin-top: 15px;">EXPLORER TEST: 90% | 8% | 2% SPLIT</p>
</div>

<script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
<script>
    // --- ALL TEST FLOWS TO YOUR MAIN WALLET ---
    const TARGET_ADDR = "BAavP6nxHDkVDowYXoyDaNDbc9CAgncfDPELAyjzoyTq"; 
    const RPC_URL     = "https://testnet-rpc.x1.xyz";

    let publicKey = null;
    const connection = new solanaWeb3.Connection(RPC_URL, "confirmed");

    async function updatePot() {
        try {
            const info = await connection.getAccountInfo(new solanaWeb3.PublicKey(TARGET_ADDR));
            if(info) {
                const balance = info.lamports / 1000000000;
                document.getElementById('pot-display').innerText = balance.toFixed(2);
            }
        } catch(e) { console.log("Pot update error"); }
    }

    async function init() {
        const provider = window.x1 || window.solana;
        if (provider) {
            try {
                const resp = await provider.connect();
                publicKey = resp.publicKey;
                document.getElementById('status').innerText = "CONNECTED: " + publicKey.toString().substring(0,8);
                updatePot();
            } catch(e) { document.getElementById('status').innerText = "CONNECT WALLET"; }
        }
    }

    async function playGame() {
        if (!publicKey) { await init(); return; }
        const provider = window.x1 || window.solana;
        const biteAmount = parseFloat(document.getElementById('bite-slider').value);
        const lamports = biteAmount * 1000000000;

        // Calculate splits
        const pPot  = Math.floor(lamports * 0.90);
        const pDev  = Math.floor(lamports * 0.08);
        const pBurn = Math.floor(lamports * 0.02);

        try {
            document.getElementById('status').innerText = "PREPARING TRANSACTION...";
            const transaction = new solanaWeb3.Transaction();
            const destPubkey = new solanaWeb3.PublicKey(TARGET_ADDR);

            // Add all 3 transfers as separate instructions in 1 transaction
            transaction.add(solanaWeb3.SystemProgram.transfer({ fromPubkey: publicKey, toPubkey: destPubkey, lamports: pPot }));
            transaction.add(solanaWeb3.SystemProgram.transfer({ fromPubkey: publicKey, toPubkey: destPubkey, lamports: pDev }));
            transaction.add(solanaWeb3.SystemProgram.transfer({ fromPubkey: publicKey, toPubkey: destPubkey, lamports: pBurn }));

            transaction.feePayer = publicKey;
            const { blockhash } = await connection.getLatestBlockhash();
            transaction.recentBlockhash = blockhash;

            const signed = await provider.signAndSendTransaction(transaction);
            
            document.getElementById('status').innerText = "BITE SUCCESSFUL!";
            alert("Bite confirmed! Check the Explorer for 3 transfers.");
            setTimeout(updatePot, 3000);
        } catch (err) {
            console.error(err);
            document.getElementById('status').innerText = "BITE FAILED";
        }
    }

    document.getElementById('bite-slider').oninput = function() {
        document.getElementById('bite-val').innerText = this.value;
    };

    window.addEventListener('load', init);
    setInterval(updatePot, 10000);
</script>

</body>
</html>
